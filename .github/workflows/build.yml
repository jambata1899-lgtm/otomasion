name: Visual Studio Build (NET Framework)

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    # برای بیلد NET Framework 4.8 یا ویندوز فرمز، حتما به ویندوز نیاز داریم
    runs-on: windows-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    # 1. نصب ابزارهای MSBuild و Visual Studio
    - name: Setup MSBuild
      uses: microsoft/setup-msbuild@v2

    # 2. نصب ابزار مدیریت پکیج NuGet
    - name: Setup NuGet
      uses: NuGet/setup-nuget@v2

    # 3. Restore پکیج ها با ابزار NuGet (برای NET Framework بهترین روش است)
    - name: Restore NuGet packages
      run: nuget restore PaygirLettersApp.sln

    # 4. Build با ابزار MSBuild (که NET Framework را بهتر می شناسد)
    # اضافه کردن /p:TargetFrameworks برای شبیه سازی بیلد مدرن
    - name: Build Solution
      run: msbuild PaygirLettersApp.sln /p:Configuration=Release /t:Rebuild /p:LangVersion=latest /p:TargetFrameworks=net8.0-windows;net48

    # 5. Upload Artifact
    - name: Upload Artifact
      uses: actions/upload-artifact@v4
      with:
        name: PaygirLettersApp-Release
        # این مسیر را باید با مسیر فایل خروجی واقعی خود تطبیق دهید (مثلاً پوشه bin/Release)
        path: PaygirLettersApp/bin/Release/
        retention-days: 5
